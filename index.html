<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>HSTC - Helvetic Security & Transport Corp</title>
        <link rel="stylesheet" href="styles.css">
        <link rel="icon" href="assets/HSTC-Logo.png" type="image/png">
    </head>
<body>

    <!-- Navigation -->
    <nav class="main-nav">
        <div class="nav-links">
            <a href="#home">Startseite</a>
            <a href="#about-us">Über Uns</a>
            <a href="#orga-calendar">Orga-Kalender</a>
            <a href="#merch">Merch-Store</a>
            <a href="#join-us">Mitglied werden</a>
            <a href="#contact">Kontakt</a>
            <a href="#orga-ships">Orga Schiffe</a>
        </div>
        <button id="discord-login" class="cta-button">Login mit Discord</button>
    </nav>

    <!-- Hero Section -->
    <header id="hero">
        <div class="hero-content">
            <img src="assets/HSTC-Logo.png" alt="HSTC Logo" class="logo">
            <h1>Explore. Secure. Conquer.</h1>
            <div class="cta-buttons">
                <a href="https://discord.gg/jV8rByuJ4G" class="cta-button">Tritt unserem Discord bei</a>
                <a href="#merch" class="cta-button">Zum Merch-Store</a>
            </div>
        </div>
    </header>

    <!-- Über Uns -->
    <section id="about-us">
        <h2>Über Uns</h2>
        <p>Die HSTC ist eine professionelle Star Citizen Organisation, spezialisiert auf Sicherheit, Transport und strategische Missionen.</p>
    </section>

    <!-- Orga-Kalender -->
    <section id="orga-calendar" class="orga-calendar">
        <h2>Orga-Kalender</h2>
        <div class="calendar-grid">
            <div class="calendar-day">Mo</div>
            <div class="calendar-day">Di</div>
            <div class="calendar-day">Mi</div>
            <div class="calendar-day">Do</div>
            <div class="calendar-day">Fr</div>
            <div class="calendar-day">Sa</div>
            <div class="calendar-day">So</div>
        </div>
        <p>Hier findest du unsere geplanten Events, Trainings und Missionen.</p>
    </section>

    <!-- Orga-Schiffe -->
    <section id="orga-ships" class="orga-ships">
        <h2>Unsere Orga Schiffe</h2>
        <div class="ships-container">
            <div class="ship-item">
                <img src="assets/ship1.png" alt="Ship 1">
                <h3>Ship 1</h3>
                <p>Beschreibung des Schiffs 1.</p>
            </div>
            <div class="ship-item">
                <img src="assets/ship2.png" alt="Ship 2">
                <h3>Ship 2</h3>
                <p>Beschreibung des Schiffs 2.</p>
            </div>
        </div>
    </section>

    <!-- Merch-Store -->
    <section id="merch" class="merch-container">
        <h2>HSTC Merch-Store</h2>
        <div class="merch-item">
            <img src="assets/tshirt.png" alt="HSTC T-Shirt">
            <h3>HSTC T-Shirt</h3>
            <a href="#contact" class="cta-button">Jetzt Anfragen</a>
        </div>
        <div class="merch-item">
            <img src="assets/hoodie.png" alt="HSTC Hoodie">
            <h3>HSTC Hoodie</h3>
            <a href="#contact" class="cta-button">Jetzt Anfragen</a>
        </div>
    </section>

    <!-- Mitglied werden -->
    <section id="join-us">
        <h2>Mitglied werden</h2>
        <p>Schließe dich uns an und werde Teil unserer wachsenden Community.</p>
    </section>

    <!-- Kontakt -->
    <section id="contact">
        <h2>Kontakt & Socials</h2>
        <p>Fragen? Schreib uns oder tritt unserem Discord bei!</p>
        <iframe src="https://discord.com/widget?id=628996745837150211&theme=dark" style="height:250px;border-radius:20px" allowtransparency="true" frameborder="0"></iframe>
    </section>

    <!-- User Roles Section -->
    <section id="user-roles">
        <h2>User Roles</h2>
        <div id="roles-container"></div>
    </section>

    <script src="scripts.js"></script>
    <script>
        document.getElementById('discord-login').addEventListener('click', () => {
            window.location.href = '/auth/discord';
        });
    </script>

</body>
</html>

<!-- OAuth2 Redirect Page -->
<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>OAuth2 Redirect</title>
    </head>
<body>
    <script>
        const clientId = window.env.CLIENT_ID;
        const clientSecret = window.env.CLIENT_SECRET;
        const redirectUri = 'https://test.hstc.space/oauth2-redirect.html'; // Update with your domain
        const guildId = 'YOUR_GUILD_ID'; // Replace with your Discord server ID

        const code = new URLSearchParams(window.location.search).get('code');

        if (code) {
            fetch('https://discord.com/api/oauth2/token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    client_id: clientId,
                    client_secret: clientSecret,
                    grant_type: 'authorization_code',
                    code: code,
                    redirect_uri: redirectUri
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.access_token) {
                    // Store the access token in local storage or a cookie
                    localStorage.setItem('discordAccessToken', data.access_token);
                    // Fetch user roles
                    fetchUserRoles(data.access_token);
                } else {
                    // Handle error
                    console.error('OAuth2 login failed', data);
                }
            })
            .catch(error => {
                console.error('Error fetching access token:', error);
            });
        } else {
            console.error('No authorization code found');
        }

        function fetchUserRoles(accessToken) {
            fetch(`https://discord.com/api/v9/users/@me/guilds/${guildId}/member`, {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.roles) {
                    displayRoles(data.roles);
                } else {
                    console.error('Failed to fetch user roles', data);
                }
            })
            .catch(error => {
                console.error('Error fetching user roles:', error);
            });
        }

        function displayRoles(roles) {
            const rolesContainer = document.createElement('div');
            rolesContainer.innerHTML = `<h2>User Roles</h2><ul>${roles.map(role => `<li>${role}</li>`).join('')}</ul>`;
            document.body.appendChild(rolesContainer);
        }
    </script>
</body>
</html>
